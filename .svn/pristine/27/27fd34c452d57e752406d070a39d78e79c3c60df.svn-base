'use client';

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Slider } from '@/components/ui/slider';
import { useSettingsStore } from '@/stores/settingsStore';

const TTS_PROVIDERS = [
  { id: 'kokoro', name: 'Kokoro TTS', description: 'High-quality local TTS (WebGPU)', type: 'local' },
  { id: 'web-speech', name: 'Web Speech', description: 'Browser built-in (fallback)', type: 'local' },
  { id: 'openai-tts', name: 'OpenAI TTS', description: 'Cloud-based, natural voices (~$15/1M chars)', type: 'cloud' },
];

const VOICES: Record<string, Array<{ id: string; name: string; gender: string }>> = {
  kokoro: [
    { id: 'af_heart', name: 'Heart', gender: 'Female (American)' },
    { id: 'am_adam', name: 'Adam', gender: 'Male (American)' },
    { id: 'bf_emma', name: 'Emma', gender: 'Female (British)' },
    { id: 'bm_george', name: 'George', gender: 'Male (British)' },
  ],
  'web-speech': [
    { id: 'default', name: 'Default', gender: 'System voice' },
  ],
  'openai-tts': [
    { id: 'alloy', name: 'Alloy', gender: 'Neutral' },
    { id: 'echo', name: 'Echo', gender: 'Male' },
    { id: 'fable', name: 'Fable', gender: 'Neutral' },
    { id: 'onyx', name: 'Onyx', gender: 'Male' },
    { id: 'nova', name: 'Nova', gender: 'Female' },
    { id: 'shimmer', name: 'Shimmer', gender: 'Female' },
  ],
};

export function VoiceSelector() {
  const { tts, setTTSSettings } = useSettingsStore();
  const voices = VOICES[tts.provider] || [];

  return (
    <Card>
      <CardHeader>
        <CardTitle>Voice Settings</CardTitle>
        <CardDescription>
          Configure text-to-speech for AI responses
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* TTS Provider */}
        <div className="space-y-2">
          <label className="text-sm font-medium">TTS Provider</label>
          <Select
            value={tts.provider}
            onValueChange={(value) => {
              setTTSSettings({ provider: value });
              // Reset voice when provider changes
              const newVoices = VOICES[value] || [];
              if (newVoices.length > 0) {
                setTTSSettings({ voice: newVoices[0].id });
              }
            }}
          >
            <SelectTrigger>
              <SelectValue placeholder="Select TTS provider" />
            </SelectTrigger>
            <SelectContent>
              {TTS_PROVIDERS.map((provider) => (
                <SelectItem key={provider.id} value={provider.id}>
                  <div className="flex flex-col">
                    <span>{provider.name}</span>
                    <span className="text-xs text-muted-foreground">
                      {provider.description}
                    </span>
                  </div>
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>

        {/* Voice selection */}
        {voices.length > 0 && (
          <div className="space-y-2">
            <label className="text-sm font-medium">Voice</label>
            <Select
              value={tts.voice}
              onValueChange={(value) => setTTSSettings({ voice: value })}
            >
              <SelectTrigger>
                <SelectValue placeholder="Select voice" />
              </SelectTrigger>
              <SelectContent>
                {voices.map((voice) => (
                  <SelectItem key={voice.id} value={voice.id}>
                    <span className="flex items-center gap-2">
                      <span>{voice.name}</span>
                      <span className="text-xs text-muted-foreground">
                        ({voice.gender})
                      </span>
                    </span>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        )}

        {/* Speech speed */}
        <div className="space-y-3">
          <div className="flex justify-between">
            <label className="text-sm font-medium">Speech Speed</label>
            <span className="text-sm text-muted-foreground">{tts.speed.toFixed(1)}x</span>
          </div>
          <Slider
            value={[tts.speed]}
            min={0.5}
            max={2}
            step={0.1}
            onValueChange={([value]) => setTTSSettings({ speed: value })}
          />
          <div className="flex justify-between text-xs text-muted-foreground">
            <span>Slower (0.5x)</span>
            <span>Faster (2x)</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
