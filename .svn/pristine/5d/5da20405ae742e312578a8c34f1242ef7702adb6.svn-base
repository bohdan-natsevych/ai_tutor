// Types and interfaces for the application

// Provider Types
export type ProviderType = 'local' | 'cloud';

// TTS Types
export interface Voice {
  id: string;
  name: string;
  language: string;
  dialect?: string;
  gender: 'male' | 'female' | 'neutral';
}

export interface TTSOptions {
  voice: string;
  speed: number; // 0.5 - 2.0
  pitch?: number;
  language: string;
  dialect?: string;
}

// STT Types
export interface STTResult {
  transcript: string;
  confidence: number;
  isFinal: boolean;
}

// AI Types
export interface AIModel {
  id: string;
  name: string;
  contextWindow: number;
  description?: string;
}

export interface AIResponse {
  content: string;
  usage?: {
    promptTokens: number;
    completionTokens: number;
    totalTokens: number;
  };
}

export interface Analysis {
  grammarScore: number;
  grammarErrors: GrammarError[];
  vocabularyScore: number;
  vocabularySuggestions: string[];
  relevanceScore: number;
  fluencyScore: number;
  overallFeedback: string;
  alternativePhrasings: string[];
  pronunciation?: PronunciationAnalysis;
}

export interface PronunciationAnalysis {
  pronunciationScore: number;
  transcribedText: string;
  mispronunciations: Array<{
    word: string;
    heardAs: string;
    correctPronunciation: string;
  }>;
  pronunciationFeedback: string;
}

// CURSOR: GrammarError type - position field removed as AI doesn't reliably provide it
export interface GrammarError {
  original: string;
  correction: string;
  explanation: string;
}

// Chat Types
export type MessageState = 
  | 'generating'    // AI is generating response
  | 'audio_loading' // TTS is converting text to audio
  | 'playing'       // Audio is playing, text hidden
  | 'revealed';     // Audio finished, text visible

export type MessageRole = 'user' | 'assistant';

export interface ChatMessage {
  id: string;
  chatId: string;
  role: MessageRole;
  content: string;
  state: MessageState;
  audioPlayed: boolean;
  analysis?: Analysis;
  createdAt: Date;
}

export interface Chat {
  id: string;
  title: string;
  topicType: 'general' | 'roleplay' | 'topic';
  topicDetails?: Record<string, unknown>;
  language: string;
  dialect: string;
  threadId?: string; // For OpenAI Assistants API
  aiProvider: string;
  aiMode: 'chat' | 'assistant';
  createdAt: Date;
  updatedAt: Date;
}

// Settings Types
export interface LanguageSettings {
  learning: string;
  dialect: string;
  mother: string;
}

export interface TTSSettings {
  provider: string;
  voice: string;
  speed: number;
}

export interface STTSettings {
  provider: string;
}

export interface AISettings {
  provider: string;
  model: string;
  openaiMode?: 'chat' | 'assistant';
  openaiAssistantId?: string;
}

export interface ContextSettings {
  recentWindowSize: number;
  summarizeAfterMessages: number;
  summarizationProvider: 'same' | 'local';
  localSummarizationModel?: string;
  disableSummarization: boolean;
}

export interface UISettings {
  listenFirstMode: boolean;
  theme: 'light' | 'dark' | 'system';
}

export interface CustomPrompts {
  system?: string;
  analysis?: string;
  topics: Record<string, string>;
}

export interface AppSettings {
  language: LanguageSettings;
  tts: TTSSettings;
  stt: STTSettings;
  ai: AISettings;
  context: ContextSettings;
  ui: UISettings;
  prompts: CustomPrompts;
}

// Vocabulary Types
export interface VocabularyEntry {
  id: string;
  word: string;
  translation: string;
  example: string;
  context?: string;
  createdAt: Date;
}

// Translation Types
export interface TranslationResult {
  sourceText: string;
  translatedText: string;
  sourceLanguage: string;
  targetLanguage: string;
  examples?: string[];
}

// Context Types
export interface ConversationContext {
  chatId: string;
  threadId?: string;
  messages: Array<{
    role: 'system' | 'user' | 'assistant';
    content: string;
  }>;
  systemPrompt: string;
  summary?: string;
}
